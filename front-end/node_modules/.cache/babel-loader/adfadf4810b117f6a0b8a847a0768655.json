{"ast":null,"code":"import _objectSpread from\"/home/enyel/Desktop/yandex1/react-around-api-full/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/enyel/Desktop/yandex1/react-around-api-full/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/enyel/Desktop/yandex1/react-around-api-full/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/* eslint-disable no-console */ /* eslint-disable react/button-has-type */import React,{useState,useEffect}from'react';import Header from'./Header';import Main from'./Main';import AddCard from'./AddPlacePopup';import EditProfile from'./EditProfilePopup';import EditAvatar from'./EditAvatarPopup';import ImagePopup from'./ImagePopup';import Footer from'./Footer';import{CurrentUserContext}from'../contexts/CurrentUserContext';import Login from'./Login';import Register from'./Register';import{Route,Switch,Redirect,useHistory}from'react-router-dom';import ProtectedRoute from'./ProtectedRoute';import*as auth from'../utils/Auth';import InfoToolTip from'./InfoToolTip';import Api from'../utils/Api';var App=function App(){// testing loggedIn\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),loggedIn=_useState2[0],setLoggedIn=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),userEmail=_useState4[0],setUserEmail=_useState4[1];//\nvar _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isSuccessful=_useState6[0],setIsSuccessful=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isInfoToolTipOpen=_useState8[0],setIsInfoToolTipOpen=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isEditProfilePopupOpen=_useState10[0],setIsEditProfilePopupOpen=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isEditAvatarPopupOpen=_useState12[0],setIsEditAvatarPopupOpen=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isAddPlacePopupOpen=_useState14[0],setIsAddPlacePopupOpen=_useState14[1];var _useState15=useState({avatar:'',name:'',about:''}),_useState16=_slicedToArray(_useState15,2),currentUser=_useState16[0],setCurrentUser=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),cards=_useState18[0],setCards=_useState18[1];var _useState19=useState(''),_useState20=_slicedToArray(_useState19,2),selectedCard=_useState20[0],setSelectedCard=_useState20[1];var _useState21=useState(''),_useState22=_slicedToArray(_useState21,2),token=_useState22[0],setToken=_useState22[1];//\nvar history=useHistory();//creating api\nvar api=new Api({baseUrl:'http://api.enyelbackend.students.nomoreparties.site',// baseUrl: 'http://localhost:3000',\nheaders:{Authorization:\"Bearer \".concat(token),'content-type':'application/json'}});// handle token check\nfunction handleTokenCheck(){var jwt=localStorage.getItem('jwt');auth.checkToken(jwt).then(function(res){setToken(jwt);setLoggedIn(true);setUserEmail(res.email);}).then(function(){return history.push('/');}).catch(function(err){// console.log(err);\nsetIsSuccessful(false);setIsInfoToolTipOpen(true);});}//\nvar handleCardLike=function handleCardLike(card){var isLiked=card.likes.some(function(l){return l===currentUser._id;});// console.log(isLiked);\napi.changeLikeCardStatus(card._id,isLiked).then(function(newCard){var newCards=cards.map(function(c){return c._id===card._id?newCard:c;});setCards(newCards);}).catch(function(err){return console.log(err);});};var handleCardClick=function handleCardClick(card){setSelectedCard(card);};useEffect(function(){api.getUserInfo().then(function(res){// console.log(res, 999);\nsetCurrentUser(res);}).catch(function(err){return console.log(err);});},[userEmail]);useEffect(function(){api.getCardList().then(function(res){// console.log(res, 85858);\nsetCards(res.data);}).catch(function(err){return console.log(err);});},[loggedIn]);useEffect(function(){handleTokenCheck();},[]);// deleting card\nvar handleDeleteCard=function handleDeleteCard(card){api.removeCard(card._id).then(function(){var newCards=cards.filter(function(c){return c._id!==card._id;});setCards(newCards);}).catch(function(err){return console.log(err);});};function closeAllPopups(){setIsEditProfilePopupOpen(false);setIsEditAvatarPopupOpen(false);setIsAddPlacePopupOpen(false);setSelectedCard('');setIsInfoToolTipOpen(false);}var onAddPlace=function onAddPlace(newCard){api.addCard(newCard).then(function(newOne){return setCards([].concat(_toConsumableArray(cards),[newOne]));}).then(function(){setIsAddPlacePopupOpen(false);}).catch(function(err){return console.log(err);});};function handleUpdateAvatar(avatar){setCurrentUser(_objectSpread(_objectSpread({},currentUser),{},{avatar:avatar}));api.setUserAvatar({avatar:avatar}).then(function(){closeAllPopups();}).catch(function(err){return console.log(err);});}var updateUser=function updateUser(name,about){api.setUserInfo({name:name,about:about}).then(function(){return setCurrentUser({name:name,about:about,avatar:currentUser.avatar});}).then(function(){return setIsEditProfilePopupOpen(false);}).catch(function(err){return console.log(err);});};function handleLogin(password,email){auth.authorize(password,email).then(function(){handleTokenCheck();}).catch(function(err){// console.log(err);\nsetIsSuccessful(false);setIsInfoToolTipOpen(true);});}function handleSignup(password,email){auth.register(password,email).then(function(res){// { id, email }\n// console.log(1, res);\nif(res.error){setIsSuccessful(false);setIsInfoToolTipOpen(true);}else{setIsSuccessful(true);setIsInfoToolTipOpen(true);history.push('/signin');}}).catch(function(err){return console.log(err);});}function handleSignout(){localStorage.removeItem('jwt');setLoggedIn(false);setUserEmail('');history.push('/signin');}return/*#__PURE__*/React.createElement(CurrentUserContext.Provider,{value:currentUser},/*#__PURE__*/React.createElement(\"div\",{className:\"page\"},/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,signOut:handleSignout,component:Main,userEmail:userEmail,onEditProfile:function onEditProfile(){setIsEditProfilePopupOpen(true);},onAddCard:function onAddCard(){setIsAddPlacePopupOpen(true);},onEditAvatar:function onEditAvatar(){setIsEditAvatarPopupOpen(true);},selectedCard:selectedCard,onClose:closeAllPopups,cards:cards,onCardLike:handleCardLike,onCardDelete:handleDeleteCard,onCardClick:function onCardClick(card){return handleCardClick(card);}}),/*#__PURE__*/React.createElement(Route,{path:\"/signin\"},/*#__PURE__*/React.createElement(Header,{link:\"/signup\",linkText:\"Sing Up\"}),/*#__PURE__*/React.createElement(Login,{heading:\"Login\",buttonText:\"Log in\",handleLogin:handleLogin})),/*#__PURE__*/React.createElement(Route,{path:\"/signup\"},/*#__PURE__*/React.createElement(Header,{link:\"/signin\",linkText:\"Sign In\"}),/*#__PURE__*/React.createElement(Register,{handleSignup:handleSignup,heading:\"Sign up\",buttonText:\"Sign up\"})),/*#__PURE__*/React.createElement(Route,{path:\"/\"},/*#__PURE__*/React.createElement(Redirect,{to:\"/signin\"}))),/*#__PURE__*/React.createElement(Footer,null),/*#__PURE__*/React.createElement(EditProfile,{updateUser:updateUser,isOpen:isEditProfilePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/React.createElement(AddCard,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:onAddPlace}),/*#__PURE__*/React.createElement(EditAvatar,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/React.createElement(ImagePopup,{onClose:closeAllPopups,card:selectedCard}),/*#__PURE__*/React.createElement(InfoToolTip,{popupType:\"modal__signup\",valid:isSuccessful,isOpen:isInfoToolTipOpen,onClose:closeAllPopups})));};export default App;","map":{"version":3,"sources":["/home/enyel/Desktop/yandex1/react-around-api-full/front-end/src/components/App.js"],"names":["React","useState","useEffect","Header","Main","AddCard","EditProfile","EditAvatar","ImagePopup","Footer","CurrentUserContext","Login","Register","Route","Switch","Redirect","useHistory","ProtectedRoute","auth","InfoToolTip","Api","App","loggedIn","setLoggedIn","userEmail","setUserEmail","isSuccessful","setIsSuccessful","isInfoToolTipOpen","setIsInfoToolTipOpen","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","avatar","name","about","currentUser","setCurrentUser","cards","setCards","selectedCard","setSelectedCard","token","setToken","history","api","baseUrl","headers","Authorization","handleTokenCheck","jwt","localStorage","getItem","checkToken","then","res","email","push","catch","err","handleCardLike","card","isLiked","likes","some","l","_id","changeLikeCardStatus","newCard","newCards","map","c","console","log","handleCardClick","getUserInfo","getCardList","data","handleDeleteCard","removeCard","filter","closeAllPopups","onAddPlace","addCard","newOne","handleUpdateAvatar","setUserAvatar","updateUser","setUserInfo","handleLogin","password","authorize","handleSignup","register","error","handleSignout","removeItem"],"mappings":"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","sourcesContent":["/* eslint-disable no-console */\n/* eslint-disable react/button-has-type */\nimport React, { useState, useEffect } from 'react';\nimport Header from './Header';\nimport Main from './Main';\nimport AddCard from './AddPlacePopup';\nimport EditProfile from './EditProfilePopup';\nimport EditAvatar from './EditAvatarPopup';\nimport ImagePopup from './ImagePopup';\nimport Footer from './Footer';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport Login from './Login';\nimport Register from './Register';\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\nimport ProtectedRoute from './ProtectedRoute';\nimport * as auth from '../utils/Auth';\nimport InfoToolTip from './InfoToolTip';\nimport Api from '../utils/Api';\n\nconst App = () => {\n  // testing loggedIn\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [userEmail, setUserEmail] = useState('');\n  //\n\n  const [isSuccessful, setIsSuccessful] = useState(false);\n  const [isInfoToolTipOpen, setIsInfoToolTipOpen] = useState(false);\n\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n\n  const [currentUser, setCurrentUser] = useState({\n    avatar: '',\n    name: '',\n    about: '',\n  });\n  const [cards, setCards] = useState([]);\n  const [selectedCard, setSelectedCard] = useState('');\n  const [token, setToken] = useState('');\n\n  //\n  const history = useHistory();\n\n  //creating api\n  const api = new Api({\n    baseUrl: 'http://api.enyelbackend.students.nomoreparties.site',\n    // baseUrl: 'http://localhost:3000',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'content-type': 'application/json',\n    },\n  });\n\n  // handle token check\n  function handleTokenCheck() {\n    const jwt = localStorage.getItem('jwt');\n    auth\n      .checkToken(jwt)\n      .then((res) => {\n        setToken(jwt);\n        setLoggedIn(true);\n        setUserEmail(res.email);\n      })\n      .then(() => history.push('/'))\n      .catch((err) => {\n        // console.log(err);\n        setIsSuccessful(false);\n        setIsInfoToolTipOpen(true);\n      });\n  }\n  //\n  const handleCardLike = (card) => {\n    const isLiked = card.likes.some((l) => l === currentUser._id);\n    // console.log(isLiked);\n    api\n      .changeLikeCardStatus(card._id, isLiked)\n      .then((newCard) => {\n        const newCards = cards.map((c) => (c._id === card._id ? newCard : c));\n        setCards(newCards);\n      })\n      .catch((err) => console.log(err));\n  };\n\n  const handleCardClick = (card) => {\n    setSelectedCard(card);\n  };\n\n  useEffect(() => {\n    api\n      .getUserInfo()\n      .then((res) => {\n        // console.log(res, 999);\n        setCurrentUser(res);\n      })\n      .catch((err) => console.log(err));\n  }, [userEmail]);\n  useEffect(() => {\n    api\n      .getCardList()\n      .then((res) => {\n        // console.log(res, 85858);\n        setCards(res.data);\n      })\n      .catch((err) => console.log(err));\n  }, [loggedIn]);\n  useEffect(() => {\n    handleTokenCheck();\n  }, []);\n\n  // deleting card\n\n  const handleDeleteCard = (card) => {\n    api\n      .removeCard(card._id)\n      .then(() => {\n        const newCards = cards.filter((c) => c._id !== card._id);\n\n        setCards(newCards);\n      })\n      .catch((err) => console.log(err));\n  };\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setSelectedCard('');\n    setIsInfoToolTipOpen(false);\n  }\n  const onAddPlace = (newCard) => {\n    api\n      .addCard(newCard)\n      .then((newOne) => setCards([...cards, newOne]))\n      .then(() => {\n        setIsAddPlacePopupOpen(false);\n      })\n      .catch((err) => console.log(err));\n  };\n  function handleUpdateAvatar(avatar) {\n    setCurrentUser({ ...currentUser, avatar });\n    api\n      .setUserAvatar({ avatar })\n      .then(() => {\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  const updateUser = (name, about) => {\n    api\n      .setUserInfo({ name, about })\n      .then(() =>\n        setCurrentUser({\n          name,\n          about,\n          avatar: currentUser.avatar,\n        })\n      )\n      .then(() => setIsEditProfilePopupOpen(false))\n      .catch((err) => console.log(err));\n  };\n\n  function handleLogin(password, email) {\n    auth\n      .authorize(password, email)\n      .then(() => {\n        handleTokenCheck();\n      })\n      .catch((err) => {\n        // console.log(err);\n        setIsSuccessful(false);\n        setIsInfoToolTipOpen(true);\n      });\n  }\n\n  function handleSignup(password, email) {\n    auth\n      .register(password, email)\n      .then((res) => {\n        // { id, email }\n        // console.log(1, res);\n        if (res.error) {\n          setIsSuccessful(false);\n          setIsInfoToolTipOpen(true);\n        } else {\n          setIsSuccessful(true);\n          setIsInfoToolTipOpen(true);\n          history.push('/signin');\n        }\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleSignout() {\n    localStorage.removeItem('jwt');\n    setLoggedIn(false);\n    setUserEmail('');\n    history.push('/signin');\n  }\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className=\"page\">\n        <Switch>\n          <ProtectedRoute\n            exact\n            path=\"/\"\n            loggedIn={loggedIn}\n            signOut={handleSignout}\n            component={Main}\n            userEmail={userEmail}\n            onEditProfile={() => {\n              setIsEditProfilePopupOpen(true);\n            }}\n            onAddCard={() => {\n              setIsAddPlacePopupOpen(true);\n            }}\n            onEditAvatar={() => {\n              setIsEditAvatarPopupOpen(true);\n            }}\n            selectedCard={selectedCard}\n            onClose={closeAllPopups}\n            cards={cards}\n            onCardLike={handleCardLike}\n            onCardDelete={handleDeleteCard}\n            onCardClick={(card) => handleCardClick(card)}\n          />\n          <Route path=\"/signin\">\n            <Header link=\"/signup\" linkText=\"Sing Up\" />\n            <Login\n              heading=\"Login\"\n              buttonText=\"Log in\"\n              handleLogin={handleLogin}\n            />\n          </Route>\n          <Route path=\"/signup\">\n            <Header link=\"/signin\" linkText=\"Sign In\" />\n            <Register\n              handleSignup={handleSignup}\n              heading=\"Sign up\"\n              buttonText=\"Sign up\"\n            />\n          </Route>\n          <Route path=\"/\">\n            <Redirect to=\"/signin\" />\n          </Route>\n        </Switch>\n\n        <Footer />\n\n        <EditProfile\n          updateUser={updateUser}\n          isOpen={isEditProfilePopupOpen}\n          onClose={closeAllPopups}\n        />\n\n        <AddCard\n          isOpen={isAddPlacePopupOpen}\n          onClose={closeAllPopups}\n          onAddPlace={onAddPlace}\n        />\n\n        <EditAvatar\n          isOpen={isEditAvatarPopupOpen}\n          onClose={closeAllPopups}\n          onUpdateAvatar={handleUpdateAvatar}\n        />\n        <ImagePopup onClose={closeAllPopups} card={selectedCard} />\n        <InfoToolTip\n          popupType=\"modal__signup\"\n          valid={isSuccessful}\n          isOpen={isInfoToolTipOpen}\n          onClose={closeAllPopups}\n        />\n      </div>\n    </CurrentUserContext.Provider>\n  );\n};\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}