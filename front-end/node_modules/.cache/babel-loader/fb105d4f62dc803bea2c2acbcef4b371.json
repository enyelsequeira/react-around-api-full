{"ast":null,"code":"var _jsxFileName = \"/home/enyel/Desktop/yandex1/react-around-api-full/front-end/src/components/App.js\";\n\n/* eslint-disable no-console */\n\n/* eslint-disable react/button-has-type */\nimport React, { useState, useEffect } from 'react';\nimport Header from './Header';\nimport Main from './Main';\nimport AddCard from './AddPlacePopup';\nimport EditProfile from './EditProfilePopup';\nimport EditAvatar from './EditAvatarPopup';\nimport ImagePopup from './ImagePopup';\nimport Footer from './Footer';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport Login from './Login';\nimport Register from './Register';\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\nimport ProtectedRoute from './ProtectedRoute';\nimport * as auth from '../utils/Auth';\nimport InfoToolTip from './InfoToolTip';\nimport Api from '../utils/Api';\n\nconst App = () => {\n  // testing loggedIn\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [userEmail, setUserEmail] = useState(''); //\n\n  const [isSuccessful, setIsSuccessful] = useState(false);\n  const [isInfoToolTipOpen, setIsInfoToolTipOpen] = useState(false);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [currentUser, setCurrentUser] = useState({\n    avatar: '',\n    name: '',\n    about: ''\n  });\n  const [cards, setCards] = useState([]);\n  const [selectedCard, setSelectedCard] = useState('');\n  const [token, setToken] = useState(''); //\n\n  const history = useHistory(); //creating api\n\n  const api = new Api({\n    // baseUrl: 'http://api.enyelbackend.students.nomoreparties.site',\n    baseUrl: 'http://localhost:3000',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'content-type': 'application/json'\n    }\n  });\n  api.getPageInfo(); // handle token check\n\n  function handleTokenCheck() {\n    console.log('handleTokenCheck');\n    const jwt = localStorage.getItem('jwt');\n    auth.checkToken(jwt).then(res => {\n      console.log('res checkToken', res);\n\n      if (res.message === \"Authorization Error\") {\n        setIsSuccessful(false);\n        setLoggedIn(false);\n        throw new Error(res.message);\n      } else {\n        setToken(jwt);\n        setLoggedIn(true);\n        setUserEmail(res.email);\n      }\n    }).then(() => {\n      return api.getUserInfo().then(res => {\n        // console.log(res, 999);\n        setCurrentUser(res);\n      }).catch(err => console.log(err));\n    }).then(() => history.push('/')).catch(err => {\n      console.log('catched error', err);\n      setIsSuccessful(false); // setIsInfoToolTipOpen(true);\n    });\n  } //\n\n\n  const handleCardLike = card => {\n    const isLiked = card.likes.some(l => l === currentUser._id); // console.log(isLiked);\n\n    api.changeLikeCardStatus(card._id, isLiked).then(newCard => {\n      const newCards = cards.map(c => c._id === card._id ? newCard : c);\n      setCards(newCards);\n    }).catch(err => console.log(err));\n  };\n\n  const handleCardClick = card => {\n    setSelectedCard(card);\n  };\n\n  console.log('loggedIn', loggedIn);\n  useEffect(() => {\n    if (loggedIn) {\n      api.getCardList().then(res => {\n        // console.log(res, 85858);\n        setCards(res.data);\n      }).catch(err => console.log(err));\n    }\n  }, [loggedIn]);\n  useEffect(() => {\n    handleTokenCheck();\n  }, []); // deleting card\n\n  const handleDeleteCard = card => {\n    api.removeCard(card._id).then(() => {\n      const newCards = cards.filter(c => c._id !== card._id);\n      setCards(newCards);\n    }).catch(err => console.log(err));\n  };\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setSelectedCard('');\n    setIsInfoToolTipOpen(false);\n  }\n\n  const onAddPlace = newCard => {\n    api.addCard(newCard).then(newOne => setCards([...cards, newOne])).then(() => {\n      setIsAddPlacePopupOpen(false);\n    }).catch(err => console.log(err));\n  };\n\n  function handleUpdateAvatar(avatar) {\n    setCurrentUser({ ...currentUser,\n      avatar\n    });\n    api.setUserAvatar({\n      avatar\n    }).then(() => {\n      closeAllPopups();\n    }).catch(err => console.log(err));\n  }\n\n  const updateUser = (name, about) => {\n    api.setUserInfo({\n      name,\n      about\n    }).then(() => setCurrentUser({\n      name,\n      about,\n      avatar: currentUser.avatar\n    })).then(() => setIsEditProfilePopupOpen(false)).catch(err => console.log(err));\n  };\n\n  function handleLogin(password, email) {\n    auth.authorize(password, email).then(() => {\n      handleTokenCheck();\n    }).catch(err => {\n      // console.log(err);\n      setIsSuccessful(false);\n      setIsInfoToolTipOpen(true);\n    });\n  }\n\n  function handleSignup(password, email) {\n    auth.register(password, email).then(res => {\n      console.log(res.message, 8585); // bad way to check, better to plase error in err prop in respose or check statuscode\n      // and you have to draw more datailed error not just something went wrong\n\n      if (res.message == 'Such user already exists') {\n        setIsSuccessful(false);\n        setIsInfoToolTipOpen(true);\n      } else {\n        setIsSuccessful(true);\n        setIsInfoToolTipOpen(true);\n        history.push('/signin');\n      }\n    }).catch(err => console.log(err));\n  }\n\n  function handleSignout() {\n    localStorage.removeItem('jwt');\n    setLoggedIn(false);\n    setUserEmail('');\n    history.push('/signin');\n  }\n\n  return /*#__PURE__*/React.createElement(CurrentUserContext.Provider, {\n    value: currentUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"page\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Switch, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(ProtectedRoute, {\n    exact: true,\n    path: \"/\",\n    loggedIn: loggedIn,\n    signOut: handleSignout,\n    component: Main,\n    userEmail: userEmail,\n    onEditProfile: () => {\n      setIsEditProfilePopupOpen(true);\n    },\n    onAddCard: () => {\n      setIsAddPlacePopupOpen(true);\n    },\n    onEditAvatar: () => {\n      setIsEditAvatarPopupOpen(true);\n    },\n    selectedCard: selectedCard,\n    onClose: closeAllPopups,\n    cards: cards,\n    onCardLike: handleCardLike,\n    onCardDelete: handleDeleteCard,\n    onCardClick: card => handleCardClick(card),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Route, {\n    path: \"/signin\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Header, {\n    link: \"/signup\",\n    linkText: \"Sign Up\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Login, {\n    heading: \"Login\",\n    buttonText: \"Log in\",\n    handleLogin: handleLogin,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/signup\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Header, {\n    link: \"/signin\",\n    linkText: \"Sign In\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Register, {\n    handleSignup: handleSignup,\n    heading: \"Sign up\",\n    buttonText: \"Sign up\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Redirect, {\n    to: \"/signin\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(EditProfile, {\n    updateUser: updateUser,\n    isOpen: isEditProfilePopupOpen,\n    onClose: closeAllPopups,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(AddCard, {\n    isOpen: isAddPlacePopupOpen,\n    onClose: closeAllPopups,\n    onAddPlace: onAddPlace,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(EditAvatar, {\n    isOpen: isEditAvatarPopupOpen,\n    onClose: closeAllPopups,\n    onUpdateAvatar: handleUpdateAvatar,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 280,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(ImagePopup, {\n    onClose: closeAllPopups,\n    card: selectedCard,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(InfoToolTip, {\n    popupType: \"modal__signup\",\n    valid: isSuccessful,\n    isOpen: isInfoToolTipOpen,\n    onClose: closeAllPopups,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 9\n    }\n  })));\n};\n\nexport default App;","map":{"version":3,"sources":["/home/enyel/Desktop/yandex1/react-around-api-full/front-end/src/components/App.js"],"names":["React","useState","useEffect","Header","Main","AddCard","EditProfile","EditAvatar","ImagePopup","Footer","CurrentUserContext","Login","Register","Route","Switch","Redirect","useHistory","ProtectedRoute","auth","InfoToolTip","Api","App","loggedIn","setLoggedIn","userEmail","setUserEmail","isSuccessful","setIsSuccessful","isInfoToolTipOpen","setIsInfoToolTipOpen","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","currentUser","setCurrentUser","avatar","name","about","cards","setCards","selectedCard","setSelectedCard","token","setToken","history","api","baseUrl","headers","Authorization","getPageInfo","handleTokenCheck","console","log","jwt","localStorage","getItem","checkToken","then","res","message","Error","email","getUserInfo","catch","err","push","handleCardLike","card","isLiked","likes","some","l","_id","changeLikeCardStatus","newCard","newCards","map","c","handleCardClick","getCardList","data","handleDeleteCard","removeCard","filter","closeAllPopups","onAddPlace","addCard","newOne","handleUpdateAvatar","setUserAvatar","updateUser","setUserInfo","handleLogin","password","authorize","handleSignup","register","handleSignout","removeItem"],"mappings":"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","sourcesContent":["/* eslint-disable no-console */\n/* eslint-disable react/button-has-type */\nimport React, { useState, useEffect } from 'react';\nimport Header from './Header';\nimport Main from './Main';\nimport AddCard from './AddPlacePopup';\nimport EditProfile from './EditProfilePopup';\nimport EditAvatar from './EditAvatarPopup';\nimport ImagePopup from './ImagePopup';\nimport Footer from './Footer';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport Login from './Login';\nimport Register from './Register';\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\nimport ProtectedRoute from './ProtectedRoute';\nimport * as auth from '../utils/Auth';\nimport InfoToolTip from './InfoToolTip';\nimport Api from '../utils/Api';\n\nconst App = () => {\n  // testing loggedIn\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [userEmail, setUserEmail] = useState('');\n  //\n\n  const [isSuccessful, setIsSuccessful] = useState(false);\n  const [isInfoToolTipOpen, setIsInfoToolTipOpen] = useState(false);\n\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n\n  const [currentUser, setCurrentUser] = useState({\n    avatar: '',\n    name: '',\n    about: '',\n  });\n  const [cards, setCards] = useState([]);\n  const [selectedCard, setSelectedCard] = useState('');\n  const [token, setToken] = useState('');\n\n  //\n  const history = useHistory();\n\n  //creating api\n  const api = new Api({\n    // baseUrl: 'http://api.enyelbackend.students.nomoreparties.site',\n    baseUrl: 'http://localhost:3000',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'content-type': 'application/json',\n    },\n  });\n  api.getPageInfo()\n\n\n  // handle token check\n  function handleTokenCheck() {\n    console.log('handleTokenCheck')\n    const jwt = localStorage.getItem('jwt');\n\n    auth\n      .checkToken(jwt)\n      .then((res) => {\n        console.log('res checkToken', res)\n        if (res.message === \"Authorization Error\") {\n          setIsSuccessful(false);\n          setLoggedIn(false);\n          throw new Error(res.message);\n        } else {\n          setToken(jwt);\n          setLoggedIn(true);\n          setUserEmail(res.email);\n        }\n\n      })\n      .then(() => {\n        return api\n          .getUserInfo()\n          .then((res) => {\n            // console.log(res, 999);\n            setCurrentUser(res);\n          })\n          .catch((err) => console.log(err));\n      })\n      .then(() => history.push('/'))\n      .catch((err) => {\n        console.log('catched error', err);\n        setIsSuccessful(false);\n        // setIsInfoToolTipOpen(true);\n      });\n  }\n  //\n  const handleCardLike = (card) => {\n    const isLiked = card.likes.some((l) => l === currentUser._id);\n    // console.log(isLiked);\n    api\n      .changeLikeCardStatus(card._id, isLiked)\n      .then((newCard) => {\n        const newCards = cards.map((c) => (c._id === card._id ? newCard : c));\n        setCards(newCards);\n      })\n      .catch((err) => console.log(err));\n  };\n\n  const handleCardClick = (card) => {\n    setSelectedCard(card);\n  };\n  console.log('loggedIn', loggedIn)\n\n  useEffect(() => {\n    if (loggedIn) {\n      api\n        .getCardList()\n        .then((res) => {\n          // console.log(res, 85858);\n          setCards(res.data);\n        })\n        .catch((err) => console.log(err));\n    }\n  }, [loggedIn]);\n\n  useEffect(() => {\n    handleTokenCheck();\n  }, []);\n\n  // deleting card\n\n  const handleDeleteCard = (card) => {\n    api\n      .removeCard(card._id)\n      .then(() => {\n        const newCards = cards.filter((c) => c._id !== card._id);\n\n        setCards(newCards);\n      })\n      .catch((err) => console.log(err));\n  };\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setSelectedCard('');\n    setIsInfoToolTipOpen(false);\n  }\n  const onAddPlace = (newCard) => {\n    api\n      .addCard(newCard)\n      .then((newOne) => setCards([...cards, newOne]))\n      .then(() => {\n        setIsAddPlacePopupOpen(false);\n      })\n      .catch((err) => console.log(err));\n  };\n  function handleUpdateAvatar(avatar) {\n    setCurrentUser({ ...currentUser, avatar });\n    api\n      .setUserAvatar({ avatar })\n      .then(() => {\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  const updateUser = (name, about) => {\n    api\n      .setUserInfo({ name, about })\n      .then(() =>\n        setCurrentUser({\n          name,\n          about,\n          avatar: currentUser.avatar,\n        })\n      )\n      .then(() => setIsEditProfilePopupOpen(false))\n      .catch((err) => console.log(err));\n  };\n\n  function handleLogin(password, email) {\n    auth\n      .authorize(password, email)\n      .then(() => {\n        handleTokenCheck();\n      })\n      .catch((err) => {\n        // console.log(err);\n        setIsSuccessful(false);\n        setIsInfoToolTipOpen(true);\n      });\n  }\n\n  function handleSignup(password, email) {\n    auth\n      .register(password, email)\n      .then((res) => {\n        console.log(res.message, 8585)\n        // bad way to check, better to plase error in err prop in respose or check statuscode\n        // and you have to draw more datailed error not just something went wrong\n        if (res.message == 'Such user already exists') {\n          setIsSuccessful(false);\n          setIsInfoToolTipOpen(true);\n        } else {\n          setIsSuccessful(true);\n          setIsInfoToolTipOpen(true);\n          history.push('/signin');\n        }\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleSignout() {\n    localStorage.removeItem('jwt');\n    setLoggedIn(false);\n    setUserEmail('');\n    history.push('/signin');\n  }\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className=\"page\">\n        <Switch>\n          <ProtectedRoute\n            exact\n            path=\"/\"\n            loggedIn={loggedIn}\n            signOut={handleSignout}\n            component={Main}\n            userEmail={userEmail}\n            onEditProfile={() => {\n              setIsEditProfilePopupOpen(true);\n            }}\n            onAddCard={() => {\n              setIsAddPlacePopupOpen(true);\n            }}\n            onEditAvatar={() => {\n              setIsEditAvatarPopupOpen(true);\n            }}\n            selectedCard={selectedCard}\n            onClose={closeAllPopups}\n            cards={cards}\n            onCardLike={handleCardLike}\n            onCardDelete={handleDeleteCard}\n            onCardClick={(card) => handleCardClick(card)}\n          />\n          <Route path=\"/signin\">\n            <Header link=\"/signup\" linkText=\"Sign Up\" />\n            <Login\n              heading=\"Login\"\n              buttonText=\"Log in\"\n              handleLogin={handleLogin}\n            />\n          </Route>\n          <Route path=\"/signup\">\n            <Header link=\"/signin\" linkText=\"Sign In\" />\n            <Register\n              handleSignup={handleSignup}\n              heading=\"Sign up\"\n              buttonText=\"Sign up\"\n            />\n          </Route>\n          <Route path=\"/\">\n            <Redirect to=\"/signin\" />\n          </Route>\n        </Switch>\n\n        <Footer />\n\n        <EditProfile\n          updateUser={updateUser}\n          isOpen={isEditProfilePopupOpen}\n          onClose={closeAllPopups}\n        />\n\n        <AddCard\n          isOpen={isAddPlacePopupOpen}\n          onClose={closeAllPopups}\n          onAddPlace={onAddPlace}\n        />\n\n        <EditAvatar\n          isOpen={isEditAvatarPopupOpen}\n          onClose={closeAllPopups}\n          onUpdateAvatar={handleUpdateAvatar}\n        />\n        <ImagePopup onClose={closeAllPopups} card={selectedCard} />\n        <InfoToolTip\n          popupType=\"modal__signup\"\n          valid={isSuccessful}\n          isOpen={isInfoToolTipOpen}\n          onClose={closeAllPopups}\n        />\n      </div>\n    </CurrentUserContext.Provider>\n  );\n};\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}